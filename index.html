<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Agentic Symphony | Faramarz Kowsari</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Noto+Sans+Arabic:wght@300;400;700;900&family=Playfair+Display:ital,wght@0,600;0,800;1,600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #2563eb;
            --glass: rgba(255, 255, 255, 0.95);
        }

        body { font-family: 'Inter', sans-serif; background: #f8fafc; overflow-x: hidden; }
        
        /* Typography & RTL */
        .serif { font-family: 'Playfair Display', serif; }
        .fa-font { font-family: 'Noto Sans Arabic', sans-serif; }
        
        .rtl { direction: rtl; }
        .rtl .flip-icon { transform: scaleX(-1); }
        .rtl .text-justify { text-align: justify; }

        /* Mobile Player Fixed Bottom */
        .player-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-top: 1px solid #e2e8f0;
            padding-bottom: env(safe-area-inset-bottom);
            z-index: 50;
            transform: translateY(120%);
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: 0 -4px 20px rgba(0,0,0,0.05);
        }
        .player-bar.active { transform: translateY(0); }

        /* Prevent content from being hidden behind player */
        .safe-bottom { padding-bottom: 140px; }

        /* Transitions */
        .fade-in { animation: fadeIn 0.6s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="antialiased text-slate-800">

    <!-- Mobile Header -->
    <header class="md:hidden fixed top-0 w-full z-40 bg-white/90 backdrop-blur border-b border-slate-200 h-16 flex justify-between items-center px-4 shadow-sm">
        <button onclick="ui.toggleSidebar()" class="text-slate-600 p-2"><i class="fas fa-bars text-xl"></i></button>
        <span class="font-bold text-slate-800 serif">The Agentic Symphony</span>
        <div class="w-8"></div>
    </header>

    <div class="flex h-screen pt-16 md:pt-0">
        
        <!-- SIDEBAR -->
        <aside id="sidebar" class="fixed md:relative z-50 w-80 h-full bg-white border-r border-slate-200 flex flex-col transform -translate-x-full md:translate-x-0 transition-transform duration-300 shadow-2xl md:shadow-none">
            
            <!-- Author Profile -->
            <div class="p-6 flex flex-col items-center bg-gradient-to-b from-slate-50 to-white relative border-b border-slate-100">
                <button onclick="ui.toggleSidebar()" class="md:hidden absolute top-4 right-4 text-slate-400"><i class="fas fa-times"></i></button>
                
                <!-- Dynamic Cover -->
                <div class="w-32 h-48 mb-4 shadow-lg rounded-md overflow-hidden bg-gray-200 relative">
                    <img id="cover-img" src="" class="w-full h-full object-cover transition-opacity duration-300 opacity-0" alt="Book Cover">
                </div>

                <h1 class="text-lg font-bold text-slate-900 serif">Faramarz Kowsari</h1>
                <p class="text-[10px] font-bold text-blue-600 uppercase tracking-widest mt-1">Strategic AI Architect</p>
                
                <!-- Socials -->
                <div class="flex space-x-5 mt-4 text-slate-400">
                    <a href="mailto:info@faramarzkowsari.com" class="hover:text-blue-600 transition"><i class="fas fa-envelope text-lg"></i></a>
                    <a href="https://www.linkedin.com/in/faramarzkowsari" target="_blank" class="hover:text-blue-700 transition"><i class="fab fa-linkedin text-lg"></i></a>
                    <a href="https://play.google.com/store/search?q=Faramarz_Kowsari&c=books" target="_blank" class="hover:text-green-600 transition"><i class="fab fa-google-play text-lg"></i></a>
                </div>
            </div>

            <!-- Language Switcher -->
            <div class="p-4 border-b border-slate-100 bg-slate-50">
                <div class="flex bg-white rounded-lg p-1 shadow-sm border border-slate-200">
                    <button onclick="app.setLang('en')" id="btn-en" class="flex-1 py-2 text-xs font-bold rounded transition-colors">ENG</button>
                    <button onclick="app.setLang('tr')" id="btn-tr" class="flex-1 py-2 text-xs font-bold rounded transition-colors">TUR</button>
                    <button onclick="app.setLang('fa')" id="btn-fa" class="flex-1 py-2 text-xs font-bold rounded transition-colors fa-font">فا</button>
                </div>
            </div>

            <!-- Chapters -->
            <div class="flex-1 overflow-y-auto p-4 safe-bottom">
                <h3 id="toc-header" class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-3 px-2">Chapters</h3>
                <div id="chapter-list" class="space-y-1"></div>
            </div>

            <!-- Fixed Download -->
            <div class="p-4 border-t border-slate-200 bg-white absolute bottom-0 w-full z-10">
                <a id="dl-link" href="#" target="_blank" class="flex items-center justify-center w-full py-3 bg-slate-900 text-white rounded-lg shadow hover:bg-blue-600 transition">
                    <i class="fas fa-file-pdf mr-2"></i>
                    <span id="dl-text" class="text-sm font-bold">Download PDF</span>
                </a>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main id="main-container" class="flex-1 overflow-y-auto bg-white relative w-full scroll-smooth">
            <div class="max-w-3xl mx-auto px-6 py-12 md:py-20 safe-bottom">
                
                <!-- Chapter Header -->
                <div class="mb-10 border-b-2 border-slate-100 pb-6 fade-in">
                    <div id="chapter-meta" class="flex items-center space-x-2 mb-3 text-blue-600 flip-icon">
                        <span class="w-8 h-0.5 bg-blue-600"></span>
                        <span id="chapter-num" class="text-xs font-bold uppercase tracking-widest">Chapter 1</span>
                    </div>
                    <h2 id="chapter-title" class="text-3xl md:text-4xl font-bold text-slate-900 serif leading-tight">The Genesis of Agency</h2>
                </div>

                <!-- Text Body -->
                <article id="text-body" class="text-lg leading-loose text-slate-700 space-y-8 fade-in text-justify">
                    <!-- JS Injected -->
                </article>

                <!-- Nav Footer -->
                <div class="mt-16 pt-8 border-t border-slate-100 flex justify-between items-center fade-in" id="nav-footer">
                    <button onclick="app.nav(-1)" id="prev-btn" class="flex items-center px-5 py-3 rounded-xl bg-slate-50 hover:bg-blue-50 text-slate-600 hover:text-blue-600 transition disabled:opacity-50">
                        <i class="fas fa-arrow-left mr-2 flip-icon"></i>
                        <span id="prev-text" class="text-sm font-bold">Prev</span>
                    </button>
                    <button onclick="app.nav(1)" id="next-btn" class="flex items-center px-5 py-3 rounded-xl bg-slate-50 hover:bg-blue-50 text-slate-600 hover:text-blue-600 transition disabled:opacity-50">
                        <span id="next-text" class="text-sm font-bold">Next</span>
                        <i class="fas fa-arrow-right ml-2 flip-icon"></i>
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- AUDIO PLAYER (Fixed Bottom Bar) -->
    <div id="audio-player" class="player-bar">
        <!-- Progress Bar -->
        <div class="w-full bg-slate-200 h-1 cursor-pointer">
            <div id="audio-progress" class="bg-blue-600 h-full w-0 transition-all duration-300"></div>
        </div>
        
        <div class="max-w-4xl mx-auto px-4 py-3 flex items-center justify-between">
            <!-- Status Info -->
            <div class="flex flex-col w-1/3 overflow-hidden">
                <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Reader</span>
                <span id="audio-status" class="text-xs font-bold text-slate-800 truncate">Ready to play</span>
            </div>

            <!-- Main Controls -->
            <div class="flex items-center space-x-6">
                <button onclick="audio.stop()" class="text-slate-400 hover:text-red-500 transition"><i class="fas fa-stop"></i></button>
                
                <button onclick="audio.toggle()" id="play-btn" class="w-12 h-12 bg-blue-600 text-white rounded-full flex items-center justify-center shadow-lg active:scale-95 transition">
                    <i class="fas fa-play ml-1"></i>
                </button>

                <button onclick="audio.speed()" id="speed-btn" class="text-xs font-bold text-slate-500 w-8 text-center hover:text-blue-600">1x</button>
            </div>

            <!-- Volume (Desktop) / Spacer (Mobile) -->
            <div class="w-1/3 flex justify-end">
                <div class="hidden md:flex items-center space-x-2 w-24">
                    <i class="fas fa-volume-down text-xs text-slate-400"></i>
                    <input type="range" min="0" max="1" step="0.1" oninput="audio.setVolume(this.value)" class="w-full h-1 bg-slate-300 rounded-lg appearance-none cursor-pointer accent-blue-600">
                </div>
            </div>
        </div>
    </div>

    <!-- APP LOGIC -->
    <script>
        // --- 1. DATA REPOSITORY ---
        const db = {
            en: {
                pdf: "pdf/The Agentic Symphony -English.pdf",
                cover: "pdf/coverenglish.png",
                ui: { toc: "Chapters", dl: "Download PDF", prev: "Previous", next: "Next" },
                titles: [
                    "The Genesis of Agency", "Architectures of Coordination", "Semantic Communication Protocols", 
                    "Strategic Decomposition", "The Cognitive Loop", "Collaborative Reasoning", 
                    "The Human Maestro", "Security in the Ensemble", "Generative Aesthetics", 
                    "Edge Agency", "The Post-Programming Era"
                ],
                seed: "The transition from manual coding to agentic orchestration represents a pivotal moment in technological history. We are moving from explicit instruction to implicit intent, guiding autonomous systems to solve complex problems."
            },
            tr: {
                pdf: "pdf/The Agentic Symphony -Turkish.pdf",
                cover: "pdf/coverturkish.png",
                ui: { toc: "Bölümler", dl: "PDF İndir", prev: "Önceki", next: "Sonraki" },
                titles: [
                    "Ajanlığın Doğuşu", "Koordinasyon Mimarileri", "Anlamsal İletişim Protokolleri", 
                    "Stratejik Ayrıştırma", "Bilişsel Döngü", "İşbirlikçi Akıl Yürütme", 
                    "İnsan Maestro", "Topluluk Güvenliği", "Üretken Estetik", 
                    "Uç Nokta Ajanlığı", "Programlama Sonrası Çağ"
                ],
                seed: "Manuel kodlamadan ajan orkestrasyonuna geçiş, teknoloji tarihinde çok önemli bir anı temsil eder. Açık talimattan örtük niyete geçiyor, otonom sistemleri karmaşık sorunları çözmeye yönlendiriyoruz."
            },
            fa: {
                pdf: "pdf/The Agentic Symphony -Persian.pdf",
                cover: "pdf/coverpersian.png",
                ui: { toc: "فهرست فصل‌ها", dl: "دانلود PDF", prev: "فصل قبل", next: "فصل بعد" },
                titles: [
                    "پیدایش عاملیت", "معماری‌های هماهنگی", "پروتکل‌های ارتباطی معنایی", 
                    "تجزیه استراتژیک", "حلقه شناختی", "استدلال مشارکتی", 
                    "رهبر ارکستر انسانی", "امنیت در گروه", "زیبایی‌شناسی مولد", 
                    "عاملیت لبه", "عصر پسابرنامه‌نویسی"
                ],
                seed: "گذار از کدنویسی دستی به ارکستراسیون عاملی، لحظه‌ای محوری در تاریخ فناوری است. ما از دستورات صریح به نیت‌های ضمنی حرکت می‌کنیم و سیستم‌های خودمختار را برای حل مسائل پیچیده هدایت می‌نماییم."
            }
        };

        // --- 2. TEXT GENERATOR (Ensuring Volume) ---
        function generateContent(lang, index) {
            const seed = db[lang].seed;
            const title = db[lang].titles[index];
            let html = "";
            
            // Generate 5 Paragraphs
            for(let i=0; i<5; i++) {
                let p = "";
                // Generate 15 sentences per paragraph
                for(let j=0; j<15; j++) {
                    if (j===0) p += `<strong>[${title}]:</strong> `;
                    p += seed + " ";
                }
                html += `<p>${p}</p>`;
            }
            return html;
        }

        // --- 3. APPLICATION CORE ---
        const app = {
            lang: 'en',
            idx: 0,

            init: function() {
                this.setLang('en');
                audio.init();
            },

            setLang: function(l) {
                this.lang = l;
                const isRTL = l === 'fa';
                const d = db[l];

                // 1. Direction & Styling
                document.body.dir = isRTL ? 'rtl' : 'ltr';
                
                const sidebar = document.getElementById('sidebar');
                sidebar.classList.toggle('text-right', isRTL);
                sidebar.dir = isRTL ? 'rtl' : 'ltr';
                
                document.getElementById('nav-footer').classList.toggle('flex-row-reverse', isRTL);
                
                // RTL Icons Flip
                document.querySelectorAll('.flip-icon').forEach(el => {
                    el.style.transform = isRTL ? 'scaleX(-1)' : 'scaleX(1)';
                });

                // Chapter Meta Alignment
                const meta = document.getElementById('chapter-meta');
                if(isRTL) {
                    meta.classList.remove('space-x-2');
                    meta.classList.add('space-x-reverse', 'space-x-2');
                    document.body.classList.add('lang-fa', 'rtl');
                } else {
                    meta.classList.remove('space-x-reverse');
                    meta.classList.add('space-x-2');
                    document.body.classList.remove('lang-fa', 'rtl');
                }

                // 2. Buttons Active State
                ['en', 'tr', 'fa'].forEach(k => {
                    const btn = document.getElementById(`btn-${k}`);
                    if (k === l) {
                        btn.className = "flex-1 py-1.5 text-xs font-bold rounded bg-blue-600 text-white shadow transition-all";
                    } else {
                        btn.className = "flex-1 py-1.5 text-xs font-bold rounded text-slate-500 hover:bg-slate-100 transition-all";
                    }
                });

                // 3. Update Static Text
                document.getElementById('toc-header').innerText = d.ui.toc;
                document.getElementById('download-text').innerText = d.ui.dl;
                document.getElementById('prev-text').innerText = d.ui.prev;
                document.getElementById('next-text').innerText = d.ui.next;
                
                // 4. Update Dynamic Links & Images
                document.getElementById('dl-link').href = d.pdf;
                const img = document.getElementById('book-cover');
                img.style.opacity = 0;
                setTimeout(() => {
                    img.src = d.cover;
                    img.style.opacity = 1;
                }, 200);

                // 5. Audio Handling (Hide for FA)
                if (l === 'fa') audio.hide();
                else audio.show();

                this.render();
                this.renderTOC();
            },

            render: function() {
                const d = db[this.lang];
                
                // Stop Audio on change
                audio.stop();

                // Chapter Number
                const numEl = document.getElementById('chapter-num');
                if (this.lang === 'fa') numEl.innerText = `${this.idx + 1}`;
                else numEl.innerText = (this.lang === 'tr' ? 'Bölüm ' : 'Chapter ') + (this.idx + 1);

                // Title & Content
                document.getElementById('chapter-title').innerText = d.titles[this.idx];
                document.getElementById('text-body').innerHTML = generateContent(this.lang, this.idx);

                // Scroll Top
                document.getElementById('main-container').scrollTo({top:0});

                // Navigation State
                document.getElementById('prev-btn').disabled = this.idx === 0;
                document.getElementById('next-btn').disabled = this.idx === 10;
                
                this.renderTOC();
            },

            renderTOC: function() {
                const list = document.getElementById('chapter-list');
                list.innerHTML = '';
                db[this.lang].titles.forEach((t, i) => {
                    const btn = document.createElement('button');
                    const isActive = i === this.idx;
                    btn.className = `w-full text-left px-3 py-2 rounded text-xs transition-colors duration-200 ${isActive ? 'bg-blue-50 text-blue-600 font-bold' : 'text-slate-600 hover:bg-slate-50'}`;
                    btn.innerText = `${i + 1}. ${t}`;
                    btn.onclick = () => {
                        this.idx = i;
                        this.render();
                        if (window.innerWidth < 768) ui.toggleSidebar();
                    };
                    list.appendChild(btn);
                });
            },

            nav: function(dir) {
                const n = this.idx + dir;
                if (n >= 0 && n <= 10) {
                    this.idx = n;
                    this.render();
                }
            }
        };

        // --- 4. AUDIO ENGINE ---
        const audio = {
            synth: window.speechSynthesis,
            voices: [],
            u: null,
            rate: 1.0,
            
            init: function() {
                // Mobile Safari Fix: Load voices asynchronously
                const load = () => { this.voices = this.synth.getVoices(); };
                if (this.synth.onvoiceschanged !== undefined) {
                    this.synth.onvoiceschanged = load;
                }
                load();
            },

            toggle: function() {
                if (this.synth.speaking && !this.synth.paused) {
                    this.synth.pause();
                    this.ui(false);
                } else if (this.synth.paused) {
                    this.synth.resume();
                    this.ui(true);
                } else {
                    this.play();
                }
            },

            play: function() {
                if (app.lang === 'fa') return;
                this.stop();

                const text = document.getElementById('text-body').innerText;
                // Chunk text for stability on mobile
                this.u = new SpeechSynthesisUtterance(text.substring(0, 3000));
                
                const target = app.lang === 'tr' ? 'tr' : 'en';
                const v = this.voices.find(v => v.lang.toLowerCase().includes(target));
                if (v) this.u.voice = v;
                
                this.u.rate = this.rate;
                this.u.onend = () => { this.ui(false); document.getElementById('audio-progress').style.width = '100%'; };
                
                // Progress Bar
                this.u.onboundary = (e) => {
                    const pct = Math.min((e.charIndex / text.length) * 100, 100);
                    document.getElementById('audio-progress').style.width = `${pct}%`;
                };

                this.synth.speak(this.u);
                this.ui(true);
            },

            stop: function() {
                this.synth.cancel();
                this.ui(false);
                document.getElementById('audio-progress').style.width = '0%';
            },

            speed: function() {
                const speeds = [0.75, 1, 1.25, 1.5];
                this.rate = speeds[(speeds.indexOf(this.rate) + 1) % speeds.length];
                document.getElementById('speed-btn').innerText = `${this.rate}x`;
                if (this.synth.speaking) { this.stop(); this.play(); }
            },

            setVolume: function(v) {
                if (this.u) this.u.volume = v;
            },

            ui: function(isPlaying) {
                const btn = document.getElementById('play-btn');
                const st = document.getElementById('audio-status');
                if (isPlaying) {
                    btn.innerHTML = '<i class="fas fa-pause"></i>';
                    st.innerText = "Reading...";
                } else {
                    btn.innerHTML = '<i class="fas fa-play ml-1"></i>';
                    st.innerText = this.synth.paused ? "Paused" : "Ready";
                }
            },

            show: function() { document.getElementById('audio-player').classList.add('active'); },
            hide: function() { 
                this.stop();
                document.getElementById('audio-player').classList.remove('active'); 
            }
        };

        // --- 5. UI HELPERS ---
        const ui = {
            toggleSidebar: function() {
                const s = document.getElementById('sidebar');
                if (s.classList.contains('-translate-x-full')) {
                    s.classList.remove('-translate-x-full');
                } else {
                    s.classList.add('-translate-x-full');
                }
            }
        };

        // Start
        window.onload = () => app.init();

    </script>
</body>
</html>
